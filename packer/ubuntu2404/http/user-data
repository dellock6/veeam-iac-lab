#cloud-config
autoinstall:
  version: 1
  refresh-installer:
    update: no   # STOP the installer from trying to self-update
  identity:
    hostname: ubuntu2404
    username: ubuntu
    # Wrap the password in double quotes to protect the hash
    password: "$6$rounds=4096$pwAk.wxvgujkbm$4x724AhMsslbqtp4dISZppC8sHsNmafcVl.R0B0qZ2q8i2TH4/x4uWfpz1JOX3glSMPo4leBoxn7Oyr62U3In." 
  ssh:
    allow-pw: true
    install-server: true
  locale: en_US.UTF-8
  keyboard:
    layout: us
  storage:
    layout:
      name: direct
  apt:
    fallback: offline-install
    geoip: true
    primary:
      - arches: [amd64]
        uri: http://gb.archive.ubuntu.com/ubuntu
  packages:
    - open-vm-tools
    - perl
    - cloud-init
  late-commands:
    - |
      echo 'ubuntu ALL=(ALL) NOPASSWD:ALL' > /target/etc/sudoers.d/ubuntu
      curtin in-target -- chmod 440 /etc/sudoers.d/ubuntu